{"ast":null,"code":"import _objectSpread from\"C:/Users/RaulGuillen/Desktop/ONG/pop_rdj_js/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/Users/RaulGuillen/Desktop/ONG/pop_rdj_js/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import firebaseConfig,{auth,db}from'../utils/firebase';import moment from'moment';import{Table,Modal,Button}from'react-bootstrap';import SurveyContainer from'./SurveyContainer';import logoRdf from'../Resources/logo_rjf.png';import gifTenor from'../Resources/tenor.gif';import Calendar from'../Components/Calendar';import SvgWithMessage from'../Components/SvgWithMessage';import{ReactComponent as Empty}from\"@svgr/webpack?-svgo,+titleProp,+ref!./empty.svg\";import{FaCheckCircle}from'react-icons/fa';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var TableContainer=function TableContainer(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),show=_useState2[0],setShow=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showEmpty=_useState4[0],setShowEmpty=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),confirm=_useState6[0],setConfirm=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),usersAlreadyEvaluated=_useState8[0],setUsersAlreadyEvaluated=_useState8[1];var _useState9=useState({company:'',userToEvaluate:'',userId:'',typeOfPerson:''}),_useState10=_slicedToArray(_useState9,2),dataModal=_useState10[0],setDataModal=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),selectedDays=_useState12[0],setSelectedDays=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),companies=_useState14[0],setCompanies=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),data=_useState16[0],setData=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),answers=_useState18[0],setAnswers=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),validUsersForcurrentUser=_useState20[0],serValidUsersForcurrentUser=_useState20[1];var _useState21=useState({}),_useState22=_slicedToArray(_useState21,2),currentUserData=_useState22[0],setCurrentUserData=_useState22[1];var setUsersOnMount=function setUsersOnMount(currentUser,dataList){var validUsers=dataList===null||dataList===void 0?void 0:dataList.filter(function(userEvaluated){return userEvaluated.company.includes(currentUser.idCompany);});serValidUsersForcurrentUser(validUsers);};useEffect(function(){writeFirebaseData('companies');writeFirebaseData('users');writeFirebaseData('answers');// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);var writeFirebaseData=function writeFirebaseData(refTable){var userRef=firebaseConfig.database().ref(refTable);userRef.on('value',function(snapshot){var usersFirebase=snapshot.val();var dataList=[];for(var id in usersFirebase){dataList.push(_objectSpread({id:id},usersFirebase[id]));}switch(refTable){case'users':setData(dataList);db.ref('auth').on('value',function(snapshot){var authUsers=snapshot.val();var currentUser=undefined;authUsers.forEach(function(user){if(user.email===auth.currentUser.email){currentUser=user;}});setCurrentUserData(currentUser);setUsersOnMount(currentUser,dataList);},function(error){return console.log(error);});break;case'companies':setCompanies(dataList);break;default:setAnswers(dataList);}});};useEffect(function(){if(selectedDays.length>0){var validAnswers=[];validUsersForcurrentUser.forEach(function(validUser){var validAnswer=undefined;answers.forEach(function(answer){if(answer.userId===validUser.id){validAnswer=answer;validAnswer&&validAnswers.push(validAnswer);}});});var usersToBlock=[];validAnswers.forEach(function(item){if(item.weekToEvaluate[0]===moment(selectedDays[1]).format('LL')&&item.weekToEvaluate[1]===moment(selectedDays[5]).format('LL')){usersToBlock.push(item.userId);}});setUsersAlreadyEvaluated(usersToBlock);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[selectedDays,answers]);var showEvaluation=function showEvaluation(name,type,id){if(selectedDays.length===7){var companyToShow=companies.find(function(element){return element.id===currentUserData.idCompany;});setDataModal({userToEvaluate:name,company:companyToShow.name,userId:id,typeOfPerson:type});setShow(true);}else{setShowEmpty(true);}};var tableToRender=/*#__PURE__*/_jsxs(Table,{striped:true,bordered:true,hover:true,className:\"w-75\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"text-center\",children:\"Nombre\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-center\",children:\"Accion\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:data===null||data===void 0?void 0:data.filter(function(userEvaluated){return userEvaluated.company.includes(currentUserData.idCompany);}).map(function(person){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"text-center\",children:person.name}),/*#__PURE__*/_jsx(\"td\",{className:\"d-flex justify-content-center\",children:usersAlreadyEvaluated.includes(person.id)?/*#__PURE__*/_jsx(FaCheckCircle,{style:{color:'#28a745',fontSize:37}}):/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:function onClick(){return showEvaluation(person.name,person.type,person.id);},style:{backgroundColor:'#FE3E00',borderBlockColor:'#FE3E00',boxShadow:'#FE3E00',borderBottomColor:'#FE3E00',borderColor:'#FE3E00'},children:\"Evaluar\"})})]});})})]});var hideFormShowConfirm=function hideFormShowConfirm(){setShow(false);setConfirm(true);};return/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center container-fluid min-vh-100 mt-5 flex-column\",children:[/*#__PURE__*/_jsx(\"img\",{src:logoRdf,width:350,className:\"p-3 img-fluid\",alt:\"RDF Logo\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"mb-4\",children:\" Bienvenido a la evaluaci\\xF3n de pasantes \"}),/*#__PURE__*/_jsx(\"h4\",{className:\"mb-3\",children:\"Por favor sigue estos sencillos pasos:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-75 mb-4 h4\",children:[/*#__PURE__*/_jsxs(\"ol\",{children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Establece la fecha a evaluar:\"}),\" Para esto, puedes navegar con las fechas en el calendario para establecer el mes a evaluar y luego debes dar click en el calendario sobre la semana que deseas evaluar.\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center\",children:/*#__PURE__*/_jsx(Calendar,{selectedDays:selectedDays,setSelectedDays:setSelectedDays})}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Selecciona persona a evaluar:\"}),\" En el siguiente listado, por favor da click en el bot\\xF3n correspondiente al pasante que deseas evaluar.\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center\",children:selectedDays.length===7?/*#__PURE__*/_jsxs(\"h4\",{className:\"bg-success text-white rounded px-4\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Est\\xE1s evaluando la semana:\"}),moment(selectedDays[1]).format('LL'),\" \\u2013\",' ',moment(selectedDays[5]).format('LL')]}):/*#__PURE__*/_jsx(\"h4\",{className:\"font-weight-bold bg-danger text-white rounded px-4\",children:\"A\\xFAn no has establecido una semana para evaluar \"})})]}),tableToRender,/*#__PURE__*/_jsxs(Modal,{show:show,onHide:function onHide(){setShow(false);},\"aria-labelledby\":\"contained-modal-title-vcenter\",size:\"xl\",centered:true,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Evaluar a pasante\"})}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsx(SurveyContainer,{hideModal:hideFormShowConfirm,userId:dataModal.userId,nameToShow:dataModal.userToEvaluate,company:dataModal.company,typeOfPerson:dataModal.typeOfPerson,weekToEvaluate:[moment(selectedDays[1]).format('LL'),moment(selectedDays[5]).format('LL')]})})]}),/*#__PURE__*/_jsxs(Modal,{show:confirm,onHide:function onHide(){setConfirm(false);},\"aria-labelledby\":\"contained-modal-title-vcenter\",centered:true,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Formulario enviado\"})}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex flex-column justify-content-center align-items-center\",children:[\"Hemos recibido tus datos correctamente.\",' ',/*#__PURE__*/_jsx(\"img\",{src:gifTenor,alt:\"\",width:100})]})}),/*#__PURE__*/_jsx(Modal.Footer,{children:/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:function onClick(){setConfirm(false);},style:{backgroundColor:'#FE3E00',borderBlockColor:'#FE3E00',boxShadow:'#FE3E00',borderBottomColor:'#FE3E00',borderColor:'#FE3E00'},children:\"Aceptar\"})})]}),/*#__PURE__*/_jsxs(Modal,{show:confirm,onHide:function onHide(){setConfirm(false);},\"aria-labelledby\":\"contained-modal-title-vcenter\",centered:true,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Formulario enviado\"})}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex flex-column justify-content-center align-items-center\",children:[\"Hemos recibido tus datos correctamente.\",' ',/*#__PURE__*/_jsx(\"img\",{src:gifTenor,alt:\"\",width:100})]})}),/*#__PURE__*/_jsx(Modal.Footer,{children:/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:function onClick(){setConfirm(false);},style:{backgroundColor:'#FE3E00',borderBlockColor:'#FE3E00',boxShadow:'#FE3E00',borderBottomColor:'#FE3E00',borderColor:'#FE3E00'},children:\"Aceptar\"})})]}),/*#__PURE__*/_jsxs(Modal,{show:showEmpty,onHide:function onHide(){setShowEmpty(false);},\"aria-labelledby\":\"contained-modal-title-vcenter\",size:\"xl\",centered:true,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsx(SvgWithMessage,{Component:Empty,headMessage:\"Datos incompletos\",message:\"Opps!! parece que aun no has seleccionado una semana para evaluar\"})})]})]});};export default TableContainer;","map":{"version":3,"sources":["C:/Users/RaulGuillen/Desktop/ONG/pop_rdj_js/src/Container/TableContainer.js"],"names":["React","useState","useEffect","firebaseConfig","auth","db","moment","Table","Modal","Button","SurveyContainer","logoRdf","gifTenor","Calendar","SvgWithMessage","FaCheckCircle","TableContainer","show","setShow","showEmpty","setShowEmpty","confirm","setConfirm","usersAlreadyEvaluated","setUsersAlreadyEvaluated","company","userToEvaluate","userId","typeOfPerson","dataModal","setDataModal","selectedDays","setSelectedDays","companies","setCompanies","data","setData","answers","setAnswers","validUsersForcurrentUser","serValidUsersForcurrentUser","currentUserData","setCurrentUserData","setUsersOnMount","currentUser","dataList","validUsers","filter","userEvaluated","includes","idCompany","writeFirebaseData","refTable","userRef","database","ref","on","snapshot","usersFirebase","val","id","push","authUsers","undefined","forEach","user","email","error","console","log","length","validAnswers","validUser","validAnswer","answer","usersToBlock","item","weekToEvaluate","format","showEvaluation","name","type","companyToShow","find","element","tableToRender","map","person","color","fontSize","backgroundColor","borderBlockColor","boxShadow","borderBottomColor","borderColor","hideFormShowConfirm","Empty"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport firebaseConfig, { auth, db } from '../utils/firebase';\r\nimport moment from 'moment';\r\nimport { Table, Modal, Button } from 'react-bootstrap';\r\nimport SurveyContainer from './SurveyContainer';\r\nimport logoRdf from '../Resources/logo_rjf.png';\r\nimport gifTenor from '../Resources/tenor.gif';\r\nimport Calendar from '../Components/Calendar';\r\nimport SvgWithMessage from '../Components/SvgWithMessage';\r\nimport { ReactComponent as Empty } from './empty.svg';\r\nimport { FaCheckCircle } from 'react-icons/fa';\r\n\r\nconst TableContainer = () => {\r\n  const [show, setShow] = useState(false);\r\n  const [showEmpty, setShowEmpty] = useState(false);\r\n  const [confirm, setConfirm] = useState(false);\r\n  const [usersAlreadyEvaluated, setUsersAlreadyEvaluated] = useState([]);\r\n  const [dataModal, setDataModal] = useState(\r\n    {\r\n      company: '',\r\n      userToEvaluate: '',\r\n      userId: '',\r\n      typeOfPerson: ''\r\n    }\r\n  );\r\n  const [selectedDays, setSelectedDays] = useState([]);\r\n  const [companies, setCompanies] = useState([]);\r\n  const [data, setData] = useState([]);\r\n  const [answers, setAnswers] = useState([]);\r\n  const [validUsersForcurrentUser, serValidUsersForcurrentUser] = useState([]);\r\n  const [currentUserData, setCurrentUserData] = useState({});\r\n\r\n\r\n  const setUsersOnMount = (currentUser, dataList) => {\r\n    const validUsers = dataList?.filter(userEvaluated => userEvaluated.company.includes(currentUser.idCompany));\r\n    serValidUsersForcurrentUser(validUsers);\r\n  };\r\n\r\n  useEffect(() => {\r\n    writeFirebaseData('companies');\r\n    writeFirebaseData('users');\r\n    writeFirebaseData('answers');\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n\r\n  const writeFirebaseData = (refTable) => {\r\n    const userRef = firebaseConfig.database().ref(refTable);\r\n    userRef.on('value', (snapshot) => {\r\n      const usersFirebase = snapshot.val();\r\n      const dataList = [];\r\n      for (let id in usersFirebase) {\r\n        dataList.push({ id, ...usersFirebase[id] });\r\n      }\r\n      switch (refTable) {\r\n        case 'users':\r\n          setData(dataList);\r\n          db.ref('auth').on('value', snapshot => {\r\n            const authUsers = snapshot.val();\r\n            let currentUser = undefined;\r\n            authUsers.forEach(user => {\r\n              if (user.email === auth.currentUser.email) {\r\n                currentUser = user;\r\n              }\r\n            });\r\n            setCurrentUserData(currentUser);\r\n            setUsersOnMount(currentUser, dataList);\r\n          }, (error) => console.log(error));\r\n          break;\r\n        case 'companies':\r\n          setCompanies(dataList);\r\n          break;\r\n        default:\r\n          setAnswers(dataList);\r\n\r\n      }\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (selectedDays.length > 0) {\r\n      const validAnswers = [];\r\n      validUsersForcurrentUser.forEach(validUser => {\r\n        let validAnswer = undefined;\r\n        answers.forEach(answer => {\r\n          if (answer.userId === validUser.id) {\r\n            validAnswer = answer;\r\n            validAnswer && validAnswers.push(validAnswer);\r\n          }\r\n        });\r\n      });\r\n      const usersToBlock = [];\r\n      validAnswers.forEach(item => {\r\n        if (item.weekToEvaluate[0] === moment(selectedDays[1]).format('LL') &&\r\n          item.weekToEvaluate[1] === moment(selectedDays[5]).format('LL')) {\r\n          usersToBlock.push(item.userId);\r\n        }\r\n      });\r\n      setUsersAlreadyEvaluated(usersToBlock);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [selectedDays, answers]);\r\n\r\n\r\n  const showEvaluation = (name, type, id) => {\r\n    if (selectedDays.length === 7) {\r\n      const companyToShow = companies.find(element => element.id === currentUserData.idCompany);\r\n      setDataModal({\r\n        userToEvaluate: name,\r\n        company: companyToShow.name,\r\n        userId: id,\r\n        typeOfPerson: type\r\n      });\r\n      setShow(true);\r\n    } else {\r\n      setShowEmpty(true);\r\n    }\r\n\r\n  };\r\n\r\n  const tableToRender = (\r\n    <Table striped bordered hover className='w-75'>\r\n      <thead>\r\n      <tr>\r\n        <th className='text-center'>Nombre</th>\r\n        <th className='text-center'>Accion</th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      {data?.filter(userEvaluated => userEvaluated.company.includes(currentUserData.idCompany)).map(person => (\r\n        <tr>\r\n          <td className='text-center'>{person.name}</td>\r\n          <td className='d-flex justify-content-center'>\r\n            {usersAlreadyEvaluated.includes(person.id) ?\r\n              (<FaCheckCircle style={{ color: '#28a745', fontSize: 37 }} />)\r\n              : (\r\n                <Button\r\n                  variant='primary'\r\n                  onClick={() => showEvaluation(person.name, person.type, person.id)}\r\n                  style={{\r\n                    backgroundColor: '#FE3E00',\r\n                    borderBlockColor: '#FE3E00',\r\n                    boxShadow: '#FE3E00',\r\n                    borderBottomColor: '#FE3E00',\r\n                    borderColor: '#FE3E00'\r\n                  }}\r\n                >\r\n                  Evaluar\r\n                </Button>\r\n              )\r\n            }\r\n\r\n          </td>\r\n        </tr>\r\n      ))}\r\n      </tbody>\r\n    </Table>\r\n  );\r\n\r\n  const hideFormShowConfirm = () => {\r\n    setShow(false);\r\n    setConfirm(true);\r\n  };\r\n\r\n  return (\r\n    <div className='d-flex align-items-center container-fluid min-vh-100 mt-5 flex-column'>\r\n      <img\r\n        src={logoRdf}\r\n        width={350}\r\n        className='p-3 img-fluid'\r\n        alt='RDF Logo'\r\n      />\r\n      <h1 className='mb-4'> Bienvenido a la evaluación de pasantes </h1>\r\n\r\n      <h4 className='mb-3'>Por favor sigue estos sencillos pasos:</h4>\r\n      <div className='w-75 mb-4 h4'>\r\n        <ol>\r\n          <li><strong>Establece la fecha a evaluar:</strong> Para esto, puedes navegar con las fechas en el calendario\r\n            para establecer el mes a evaluar y luego debes dar click en el calendario sobre la semana que deseas\r\n            evaluar.\r\n          </li>\r\n          <div className='d-flex justify-content-center'>\r\n            <Calendar selectedDays={selectedDays} setSelectedDays={setSelectedDays} />\r\n          </div>\r\n          <li><strong>Selecciona persona a evaluar:</strong> En el siguiente listado, por favor da click en el botón\r\n            correspondiente al pasante que deseas evaluar.\r\n          </li>\r\n        </ol>\r\n        <div className='d-flex justify-content-center'>\r\n          {selectedDays.length === 7 ? (\r\n              <h4 className='bg-success text-white rounded px-4'>\r\n                <strong>Estás evaluando la semana:</strong>\r\n                {moment(selectedDays[1]).format('LL')} –{' '}\r\n                {moment(selectedDays[5]).format('LL')}\r\n              </h4>\r\n            ) :\r\n            (\r\n              <h4 className='font-weight-bold bg-danger text-white rounded px-4'>Aún no has establecido una semana para\r\n                evaluar </h4>\r\n            )\r\n          }\r\n        </div>\r\n      </div>\r\n\r\n\r\n      {tableToRender}\r\n      <Modal\r\n        show={show}\r\n        onHide={() => {\r\n          setShow(false);\r\n        }}\r\n        aria-labelledby='contained-modal-title-vcenter'\r\n        size='xl'\r\n        centered\r\n      >\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Evaluar a pasante</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <SurveyContainer\r\n            hideModal={hideFormShowConfirm}\r\n            userId={dataModal.userId}\r\n            nameToShow={dataModal.userToEvaluate}\r\n            company={dataModal.company}\r\n            typeOfPerson={dataModal.typeOfPerson}\r\n            weekToEvaluate={[moment(selectedDays[1]).format('LL'), moment(selectedDays[5]).format('LL')]}\r\n          />\r\n        </Modal.Body>\r\n\r\n      </Modal>\r\n\r\n      <Modal\r\n        show={confirm}\r\n        onHide={() => {\r\n          setConfirm(false);\r\n        }}\r\n        aria-labelledby='contained-modal-title-vcenter'\r\n        centered>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Formulario enviado</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <div className='d-flex flex-column justify-content-center align-items-center'>\r\n            Hemos recibido tus datos correctamente.{' '}\r\n            <img src={gifTenor} alt='' width={100} />\r\n          </div>\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n          <Button\r\n            variant='primary'\r\n            onClick={() => {\r\n              setConfirm(false);\r\n            }}\r\n            style={{\r\n              backgroundColor: '#FE3E00',\r\n              borderBlockColor: '#FE3E00',\r\n              boxShadow: '#FE3E00',\r\n              borderBottomColor: '#FE3E00',\r\n              borderColor: '#FE3E00'\r\n            }}\r\n          >\r\n            Aceptar\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n\r\n\r\n      <Modal\r\n        show={confirm}\r\n        onHide={() => {\r\n          setConfirm(false);\r\n        }}\r\n        aria-labelledby='contained-modal-title-vcenter'\r\n        centered>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Formulario enviado</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <div className='d-flex flex-column justify-content-center align-items-center'>\r\n            Hemos recibido tus datos correctamente.{' '}\r\n            <img src={gifTenor} alt='' width={100} />\r\n          </div>\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n          <Button\r\n            variant='primary'\r\n            onClick={() => {\r\n              setConfirm(false);\r\n            }}\r\n            style={{\r\n              backgroundColor: '#FE3E00',\r\n              borderBlockColor: '#FE3E00',\r\n              boxShadow: '#FE3E00',\r\n              borderBottomColor: '#FE3E00',\r\n              borderColor: '#FE3E00'\r\n            }}\r\n          >\r\n            Aceptar\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n\r\n\r\n      <Modal\r\n        show={showEmpty}\r\n        onHide={() => {\r\n          setShowEmpty(false);\r\n        }}\r\n        aria-labelledby='contained-modal-title-vcenter'\r\n        size='xl'\r\n        centered\r\n      >\r\n        <Modal.Header closeButton>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <SvgWithMessage Component={Empty} headMessage='Datos incompletos'\r\n                          message='Opps!! parece que aun no has seleccionado una semana para evaluar' />\r\n        </Modal.Body>\r\n\r\n      </Modal>\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TableContainer;\r\n"]},"metadata":{},"sourceType":"module"}